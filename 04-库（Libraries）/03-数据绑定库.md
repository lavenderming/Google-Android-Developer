参见：[Data Binding Library](https://developer.android.com/topic/libraries/data-binding/index.html#data_binding_layout_files)

- [概述](#%E6%A6%82%E8%BF%B0)
- [构建环境](#%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83)
- [数据绑定编译器 V2（未完成）](#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E7%BC%96%E8%AF%91%E5%99%A8-v2%EF%BC%88%E6%9C%AA%E5%AE%8C%E6%88%90%EF%BC%89)
- [数据绑定布局文件](#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6)
    - [编写你的第一组数据绑定表达](#%E7%BC%96%E5%86%99%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E7%BB%84%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E8%A1%A8%E8%BE%BE)
    - [数据对象](#%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1)
    - [绑定数据](#%E7%BB%91%E5%AE%9A%E6%95%B0%E6%8D%AE)

# 概述

该文档介绍如何使用数据绑定库写声明式布局以及最小化用于绑定 app 逻辑和布局的胶水代码。

数据绑定库既提供了灵活性，又具备广泛的兼容性 —— 这是个支持库，因此你可以在最早 Android 2.1（API 级别 7+） 的 Android 平台版本中使用该库。 

为使用数据绑定，还需要 Android Plugin for Gradle 1.5.0-alpha1 或更高版本。见如何 [更新 Android Plugin for Gradle](https://developer.android.com/studio/releases/gradle-plugin.html#updating-plugin)。

# 构建环境

为开始数据绑定，先从 Android SDK manager 的 Support repository 中下载库。

为配置 app 让其使用数据绑定，在 app 模块的 `build.gradle` 文件中添加 `dataBinding` 元素。

使用如下代码片段配置数据绑定：

```gradle
android {
    ....
    dataBinding {
        enabled = true
    }
}
```

如果 app 模块依赖的库使用了数据绑定，则该 app 模块也要在其 `build.gradle` 文件中配置数据绑定。

另外，确保你使用兼容版本的 Android Studio。**Android Studio 1.3** 及以上提供更多对数据绑定的支持，见：[Android Studio Support for Data Binding](https://developer.android.com/topic/libraries/data-binding/index.html#studio_support)。

# 数据绑定编译器 V2（未完成）

Android Gradle Plugin **3.1.0 Canary 6** 附带一个可选的新编译器。为开始使用它，

# 数据绑定布局文件

## 编写你的第一组数据绑定表达

数据绑定布局文件相比普通布局文件有些轻微的不同，它由根标签 **layout** 开始，后面跟着 **data** 元素和 **view** 根元素。这里的 view 元素就是在无绑定布局文件中的根元素。一个简单的数据绑定布局文件如下：

```xml
<?xml version="1.0" encoding="utf-8"?>
<layout xmlns:android="http://schemas.android.com/apk/res/android">
   <data>
       <variable name="user" type="com.example.User"/>
   </data>
   <LinearLayout
       android:orientation="vertical"
       android:layout_width="match_parent"
       android:layout_height="match_parent">
       <TextView android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:text="@{user.firstName}"/>
       <TextView android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:text="@{user.lastName}"/>
   </LinearLayout>
</layout>
```

**data** 中的 user **variable** 描述了可能在该布局中使用的一个属性。

布局中的表达式写在属性值处，使用 `@{}` 语法。这里，TextView 的 text 被设为 user 的 firstName 属性。

```xml
<TextView android:layout_width="wrap_content"
          android:layout_height="wrap_content"
          android:text="@{user.firstName}"/>
```

## 数据对象

假设你现在有个 POJO 的 User：

```java
public class User {
   public final String firstName;
   public final String lastName;
   public User(String firstName, String lastName) {
       this.firstName = firstName;
       this.lastName = lastName;
   }
}
```

这种类型的对象有从不改变的数据。这种情况在 app 中很普通：有个数据只读取一次，且在此后都不改变。你也可以使用 JavaBeans 对象：

```java
public class User {
   private final String firstName;
   private final String lastName;
   public User(String firstName, String lastName) {
       this.firstName = firstName;
       this.lastName = lastName;
   }
   public String getFirstName() {
       return this.firstName;
   }
   public String getLastName() {
       return this.lastName;
   }
}
```

从数据绑定的角度，这两个类是相同的。TextView 的 `android:text` 属性中的 `@{user.firstName}` 表达式会访问前一个类中的 `firstName` 字段，或访问后一个类中的 `getFirstName()` 方法。此外，表达式还可以解析为 `firstName()`，如果该方法存在。

## 绑定数据